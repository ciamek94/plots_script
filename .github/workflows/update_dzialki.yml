name: Update Dzialki

on:
  # Run every 6 hours
  schedule:
    - cron: "0 */6 * * *"
  # Allow manual run
  workflow_dispatch:

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      # Step 3: Install Python dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install selenium pandas geopy openpyxl

      # Step 4: Install Firefox & Geckodriver
      - name: Install Firefox and Geckodriver
        run: |
          sudo apt-get update
          sudo apt-get install -y software-properties-common
          sudo add-apt-repository -y ppa:mozillateam/ppa
          sudo apt-get update
          sudo apt-get install -y firefox
          
          # Install latest Geckodriver
          GECKO_VERSION=$(curl -s https://api.github.com/repos/mozilla/geckodriver/releases/latest | grep "tag_name" | cut -d '"' -f4)
          wget "https://github.com/mozilla/geckodriver/releases/download/$GECKO_VERSION/geckodriver-$GECKO_VERSION-linux64.tar.gz"
          tar -xvzf "geckodriver-$GECKO_VERSION-linux64.tar.gz"
          sudo mv geckodriver /usr/local/bin/

      # Step 5: Run Python script
      - name: Run script
        run: |
          python script.py

      # Step 6: Commit and push results (Excel file)
      - name: Commit results
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add wyniki_ofert_z_filtra.xlsx || true
          git commit -m "Auto-update wyniki_ofert_z_filtra.xlsx" || echo "No changes to commit"
          git push